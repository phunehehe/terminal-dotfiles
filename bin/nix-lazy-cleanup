#!/usr/bin/env bash
set -efu

dead_paths=($(nix-store \
    --option gc-keep-outputs true \
    --option gc-keep-derivations false \
    --gc --print-dead))

to_delete=()
for i in "${dead_paths[@]}"
do [[ $(shuf --input-range=1-10 --head-count=1) == 1 ]] && to_delete+=($i)
done

nix-store --delete "${to_delete[@]}"
